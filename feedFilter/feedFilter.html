<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV/TSV Converter</title>
    <link rel="stylesheet" href="feedFilter.css">
</head>
<body>
    <div class="container">
        <h1>CSV/TSV File Converter</h1>
        <p class="subtitle">Convert TSV to CSV ‚Ä¢ Upload files up to 700 MB ‚Ä¢ Select specific columns</p>
        
        <label for="fileInput" class="upload-area" id="uploadArea">
            <div class="upload-icon">üìÅ</div>
            <p style="font-size: 1.2em; margin-bottom: 10px;">Drop your file here or click to browse</p>
            <p style="color: #888; font-size: 0.9em;">Supports CSV, TSV, and other delimited files</p>
            <!-- <p style="color: #667; font-size: 0.85em; margin-top: 5px;">‚ú® TSV files will be automatically converted to CSV format</p> -->
            <input type="file" id="fileInput" accept=".csv,.tsv,.txt,.tab,.dat" onchange="if(this.files[0]) handleFile(this.files[0])">
        </label>

        <div class="file-info" id="fileInfo">
            <div class="info-row">
                <span class="info-label">File Name:</span>
                <span class="info-value" id="fileName"></span>
            </div>
            <div class="info-row">
                <span class="info-label">File Size:</span>
                <span class="info-value" id="fileSize"></span>
            </div>
            <div class="info-row">
                <span class="info-label">File Type:</span>
                <span class="info-value" id="fileType"></span>
            </div>
            <div class="info-row">
                <span class="info-label">Detected Delimiter:</span>
                <span class="info-value" id="delimiter"></span>
            </div>
        </div>

        <div class="export-name-section" id="exportNameSection">
            <label class="export-name-label" for="exportNameInput">Export File Name:</label>
            <input type="text" id="exportNameInput" class="export-name-input" placeholder="Enter custom filename (without .csv extension)">
        </div>

        <div class="preview-section" id="previewSection">
            <h2 class="preview-title">Preview (First 5 Rows)</h2>
            <div class="preview-table">
                <table id="previewTable"></table>
            </div>
        </div>

        <div class="column-selector" id="columnSelector">
            <h2 class="preview-title">Select Columns to Export</h2>
            
            <div class="preset-section">
                <div class="preset-header">
                    <span class="preset-title">Header Presets</span>
                    <button class="save-preset-btn" onclick="openSavePresetModal()">Save Current Selection</button>
                </div>
                <div class="preset-list" id="presetList">
                    <div class="no-presets">No saved presets yet</div>
                </div>
            </div>

            <div class="select-controls">
                <button class="select-btn" onclick="selectAll()">Select All</button>
                <button class="select-btn" onclick="deselectAll()">Deselect All</button>
            </div>
            <div class="columns-grid" id="columnsGrid"></div>
        </div>

        <div class="button-group" id="actionButtons" style="display: none;">
            <button class="btn btn-secondary" onclick="resetFile()">Reset</button>
            <button class="btn btn-primary" id="exportBtn" onclick="exportFile()">Export as CSV</button>
        </div>

        <div class="progress-bar" id="progressBar">
            <div class="progress-fill" id="progressFill">0%</div>
        </div>

        <div class="status-message" id="statusMessage"></div>
        <div class="error-message" id="errorMessage"></div>
        
        <div style="margin-top: 20px; padding: 10px; background: rgba(0,0,0,0.05); border-radius: 5px; font-size: 0.85em; color: #666; text-align: center;">
            Having issues? Open browser console (F12) and run <code style="background: white; padding: 2px 5px; border-radius: 3px;">window.enableDebug()</code> for detailed diagnostics
        </div>
    </div>

    <!-- Modal for saving/editing presets -->
    <div id="presetModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-header" id="modalHeader">Save Preset</h2>
            <input type="text" id="presetNameInput" class="modal-input" placeholder="Enter preset name">
            <div class="modal-buttons">
                <button class="modal-btn modal-cancel" onclick="closePresetModal()">Cancel</button>
                <button class="modal-btn modal-save" onclick="savePreset()">Save</button>
            </div>
        </div>
    </div>

    <script src="feedFilter.js"></script>
</body>
</html>